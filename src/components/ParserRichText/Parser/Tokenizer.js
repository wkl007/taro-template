"use strict";function Tokenizer(t){this._state="TEXT",this._buffer="",this._sectionStart=0,this._index=0,this._cbs=t}Tokenizer.prototype.TEXT=function(t){var e=this._buffer.indexOf("<",this._index);-1!=e?(this._index=e,this._cbs.ontext(this._getSection()),this._state="BeforeTag",this._sectionStart=this._index):this._index=this._buffer.length},Tokenizer.prototype.BeforeTag=function(t){switch(t){case"/":this._state="BeforeCloseTag";break;case"!":this._state="BeforeDeclaration";break;case"?":var e=this._buffer.indexOf(">",this._index);-1!=e?(this._index=e,this._sectionStart=this._index+1):this._sectionStart=this._index=this._buffer.length,this._state="TEXT";break;case">":this._state="TEXT";break;case"<":this._cbs.ontext(this._getSection()),this._sectionStart=this._index;break;default:/\s/.test(t)?this._state="TEXT":(this._state="InTag",this._sectionStart=this._index)}},Tokenizer.prototype.InTag=function(t){("/"===t||">"===t||/\s/.test(t))&&(this._cbs.onopentagname(this._getSection()),this._state="BeforeAttrsName",this._index--)},Tokenizer.prototype.BeforeAttrsName=function(t){">"===t?(this._cbs.onopentagend(),this._state="TEXT",this._sectionStart=this._index+1):"/"===t?this._state="InSelfCloseTag":/\s/.test(t)||(this._state="InAttrsName",this._sectionStart=this._index)},Tokenizer.prototype.InAttrsName=function(t){("="===t||"/"===t||">"===t||/\s/.test(t))&&(this._cbs._attribname=this._getSection().toLowerCase(),this._sectionStart=-1,this._state="AfterAttrsName",this._index--)},Tokenizer.prototype.AfterAttrsName=function(t){"="===t?this._state="BeforeAttrsValue":"/"===t||">"===t?(this._cbs.onattribend(),this._state="BeforeAttrsName",this._index--):/\s/.test(t)||(this._cbs.onattribend(),this._state="InAttrsName",this._sectionStart=this._index)},Tokenizer.prototype.BeforeAttrsValue=function(t){'"'===t?(this._state="InAttrsValueDQ",this._sectionStart=this._index+1):"'"===t?(this._state="InAttrsValueSQ",this._sectionStart=this._index+1):/\s/.test(t)||(this._state="InAttrsValueNQ",this._sectionStart=this._index,this._index--)},Tokenizer.prototype.InAttrsValueDQ=function(t){'"'===t&&(this._cbs._attribvalue+=this._getSection(),this._cbs.onattribend(),this._state="BeforeAttrsName")},Tokenizer.prototype.InAttrsValueSQ=function(t){"'"===t&&(this._cbs._attribvalue+=this._getSection(),this._cbs.onattribend(),this._state="BeforeAttrsName")},Tokenizer.prototype.InAttrsValueNQ=function(t){(/\s/.test(t)||">"===t)&&(this._cbs._attribvalue+=this._getSection(),this._cbs.onattribend(),this._state="BeforeAttrsName",this._index--)},Tokenizer.prototype.BeforeCloseTag=function(t){/\s/.test(t)||(">"===t?this._state="TEXT":(this._state="InCloseTag",this._sectionStart=this._index))},Tokenizer.prototype.InCloseTag=function(t){(">"===t||/\s/.test(t))&&(this._cbs.onclosetag(this._getSection()),this._state="AfterCloseTag",this._index--)},Tokenizer.prototype.InSelfCloseTag=function(t){">"===t?(this._cbs.onopentagend(),this._state="TEXT",this._sectionStart=this._index+1):/\s/.test(t)||(this._state="BeforeAttrsName",this._index--)},Tokenizer.prototype.AfterCloseTag=function(t){">"===t&&(this._state="TEXT",this._sectionStart=this._index+1)},Tokenizer.prototype.BeforeDeclaration=function(t){this._state="-"==t?"InComment":"["==t?"BeforeCDATA1":"InDeclaration"},Tokenizer.prototype.InDeclaration=function(t){var e=this._buffer.indexOf(">",this._index);-1!=e?(this._index=e,this._sectionStart=e+1):this._sectionStart=this._index=this._buffer.length,this._state="TEXT"},Tokenizer.prototype.InComment=function(t){var e="-"==t?"--\x3e":">",i=this._buffer.indexOf(e,this._index);-1!=i?(this._index=i+e.length-1,this._sectionStart=this._index+1):this._sectionStart=this._index=this._buffer.length,this._state="TEXT"},Tokenizer.prototype.BeforeCDATA1=function(t){this._state="C"==t?"BeforeCDATA2":"InDeclaration"},Tokenizer.prototype.BeforeCDATA2=function(t){this._state="D"==t?"BeforeCDATA3":"InDeclaration"},Tokenizer.prototype.BeforeCDATA3=function(t){this._state="A"==t?"BeforeCDATA4":"InDeclaration"},Tokenizer.prototype.BeforeCDATA4=function(t){this._state="T"==t?"BeforeCDATA5":"InDeclaration"},Tokenizer.prototype.BeforeCDATA5=function(t){this._state="A"==t?"InCDATA":"InDeclaration"},Tokenizer.prototype.InCDATA=function(t){var e="["==t?"]]>":">",i=this._buffer.indexOf(e,this._index);-1!=i?(this._index=i+e.length-1,this._sectionStart=this._index+1):this._sectionStart=this._index=this._buffer.length,this._state="TEXT"},Tokenizer.prototype.parse=function(t){for(this._buffer+=t;this._index<this._buffer.length;this._index++)this[this._state](this._buffer[this._index]);"TEXT"===this._state&&this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._cbs.onend()},Tokenizer.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},module.exports=Tokenizer;